{% extends 'base.html' %}
{% load static %}

{% block title %}Network Whiteboard - Firewall Central{% endblock %}

{% block extra_css %}
<style>
    #whiteboard {
        width: 100%;
        height: 600px;
        border: 1px solid #ddd;
        background: #f8f9fa;
        position: relative;
        overflow: hidden;
        cursor: grab;
    }
    
    #whiteboard:active {
        cursor: grabbing;
    }
    
    .agent-node {
        position: absolute;
        width: 80px;
        height: 80px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
        cursor: move;
        box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        transition: transform 0.2s;
    }
    
    .agent-node:hover {
        transform: scale(1.1);
    }
    
    .agent-node.online {
        background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
    }
    
    .agent-node.offline {
        background: linear-gradient(135deg, #fc4a1a 0%, #f7b733 100%);
    }
    
    .agent-node.pending {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    }
    
    .agent-node.error {
        background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
    }
    
    .agent-label {
        position: absolute;
        top: 85px;
        left: 50%;
        transform: translateX(-50%);
        font-size: 12px;
        color: #333;
        background: white;
        padding: 2px 6px;
        border-radius: 3px;
        border: 1px solid #ddd;
        white-space: nowrap;
    }
    
    .connection-line {
        position: absolute;
        height: 2px;
        background: #007bff;
        transform-origin: left center;
        pointer-events: none;
        z-index: 1;
    }
    
    .toolbar {
        background: white;
        border: 1px solid #ddd;
        border-radius: 5px;
        padding: 10px;
        margin-bottom: 10px;
    }
    
    .zoom-controls {
        display: inline-block;
        margin-right: 15px;
    }
    
    .agent-info-panel {
        position: fixed;
        top: 50%;
        right: -400px;
        width: 350px;
        height: 500px;
        background: white;
        border: 1px solid #ddd;
        border-radius: 5px;
        box-shadow: -5px 0 15px rgba(0,0,0,0.1);
        transition: right 0.3s;
        z-index: 1000;
        overflow-y: auto;
    }
    
    .agent-info-panel.open {
        right: 20px;
    }
    
    .context-menu {
        position: absolute;
        background: white;
        border: 1px solid #ddd;
        border-radius: 5px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        z-index: 1001;
        display: none;
        min-width: 150px;
    }
    
    .context-menu ul {
        list-style: none;
        margin: 0;
        padding: 5px 0;
    }
    
    .context-menu li {
        padding: 8px 15px;
        cursor: pointer;
    }
    
    .context-menu li:hover {
        background: #f8f9fa;
    }
</style>
{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h1><i class="fas fa-project-diagram"></i> Network Whiteboard</h1>
        <p class="text-muted">Visual representation of your firewall infrastructure</p>
    </div>
</div>

<!-- Toolbar -->
<div class="toolbar">
    <div class="zoom-controls">
        <button class="btn btn-sm btn-outline-secondary" onclick="zoomIn()">
            <i class="fas fa-search-plus"></i>
        </button>
        <span id="zoom-level">100%</span>
        <button class="btn btn-sm btn-outline-secondary" onclick="zoomOut()">
            <i class="fas fa-search-minus"></i>
        </button>
    </div>
    
    <button class="btn btn-sm btn-outline-primary" onclick="resetView()">
        <i class="fas fa-home"></i> Reset View
    </button>
    
    <button class="btn btn-sm btn-outline-success" onclick="autoLayout()">
        <i class="fas fa-magic"></i> Auto Layout
    </button>
    
    <button class="btn btn-sm btn-outline-info" onclick="toggleConnections()">
        <i class="fas fa-eye"></i> Toggle Connections
    </button>
    
    <div class="float-end">
        <span class="badge bg-success me-2">● Online</span>
        <span class="badge bg-danger me-2">● Offline</span>
        <span class="badge bg-warning me-2">● Pending</span>
        <span class="badge bg-secondary">● Error</span>
    </div>
</div>

<!-- Whiteboard -->
<div id="whiteboard">
    <!-- Agent nodes will be dynamically added here -->
</div>

<!-- Agent Info Panel -->
<div id="agent-info-panel" class="agent-info-panel">
    <div class="p-3">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h5 id="agent-info-title">Agent Details</h5>
            <button class="btn btn-sm btn-outline-secondary" onclick="closeAgentInfo()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div id="agent-info-content">
            <!-- Agent details will be loaded here -->
        </div>
    </div>
</div>

<!-- Context Menu -->
<div id="context-menu" class="context-menu">
    <ul>
        <li onclick="showAgentInfo()"><i class="fas fa-info-circle"></i> View Details</li>
        <li onclick="createConnection()"><i class="fas fa-link"></i> Create Connection</li>
        <li onclick="editAgent()"><i class="fas fa-edit"></i> Edit Agent</li>
        <li onclick="executeCommand()"><i class="fas fa-terminal"></i> Execute Command</li>
    </ul>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/whiteboard.js' %}"></script>
<script>
// Initialize whiteboard with data
const agents = {{ agents|safe }};
const connections = {{ connections|safe }};
const whiteboardState = {{ whiteboard_state|safe }};

// Initialize the whiteboard
initWhiteboard(agents, connections, whiteboardState);
</script>
{% endblock %}